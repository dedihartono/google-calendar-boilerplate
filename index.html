<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Calendar Integration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#667eea',
                        secondary: '#764ba2'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-primary to-secondary min-h-screen">
    <div class="container mx-auto px-4 py-6 h-screen flex flex-col">
        <!-- Header -->
        <div class="text-center mb-6 flex-shrink-0">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">
                📅 Google Calendar Integration
            </h1>
            <p class="text-lg text-white/90">View and manage your calendar events</p>
        </div>

        <!-- Main Calendar Section -->
        <div class="flex-1 max-w-6xl mx-auto w-full">
            <div class="bg-white rounded-2xl shadow-2xl overflow-hidden h-full flex flex-col">
                <div class="p-4 bg-gradient-to-r from-primary to-secondary flex-shrink-0">
                    <h2 class="text-xl font-semibold text-white">📅 Calendar View</h2>
                </div>
                <div class="p-4 flex-1 flex flex-col">
                    <div class="flex-1 min-h-0">
                        <iframe 
                            class="w-full h-full rounded-lg border-0 shadow-lg"
                            src="https://calendar.google.com/calendar/embed?src=b8a832bd6facdcc5827d8b05327ae51858849fcb52a8ba831df74c8d376cbc30%40group.calendar.google.com"
                            frameborder="0">
                        </iframe>
                    </div>
                    
                    <div class="flex flex-wrap gap-2 mt-4 justify-center flex-shrink-0">
                        <button onclick="openEventModal()" class="px-6 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-full font-medium transition-all duration-200 hover:scale-105 shadow-lg text-sm">
                            ➕ Create Event
                        </button>
                        <button onclick="refreshCalendar()" class="px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-full font-medium transition-all duration-200 hover:scale-105 shadow-lg text-sm">
                            🔄 Refresh
                        </button>
                        <button onclick="showAPIInfo()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-full font-medium transition-all duration-200 hover:scale-105 shadow-lg text-sm">
                            📡 API Info
                        </button>
                        <button onclick="testAPI()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-full font-medium transition-all duration-200 hover:scale-105 shadow-lg text-sm">
                            🧪 Test API
                        </button>
                        <a href="/api/events" target="_blank" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full font-medium transition-all duration-200 hover:scale-105 shadow-lg no-underline text-sm">
                            📋 Events
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="status" class="fixed top-4 right-4 max-w-sm z-50" style="display: none;"></div>

        <!-- API Info Section -->
        <div id="apiSection" class="mt-4 max-w-6xl mx-auto bg-white rounded-2xl shadow-2xl overflow-hidden" style="display: none;">
            <div class="p-4 bg-gradient-to-r from-blue-500 to-blue-600">
                <h3 class="text-xl font-semibold text-white">🔌 API Endpoints</h3>
            </div>
            <div class="p-4">
                <div class="grid md:grid-cols-2 gap-3">
                    <div class="bg-gray-50 p-3 rounded-lg border-l-4 border-primary">
                        <strong class="text-primary text-sm">GET /api/events</strong>
                        <p class="text-gray-600 mt-1 text-xs">List all calendar events</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border-l-4 border-green-500">
                        <strong class="text-green-600 text-sm">POST /api/events</strong>
                        <p class="text-gray-600 mt-1 text-xs">Create a new event</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border-l-4 border-blue-500">
                        <strong class="text-blue-600 text-sm">GET /api/events/:id</strong>
                        <p class="text-gray-600 mt-1 text-xs">Get specific event details</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border-l-4 border-yellow-500">
                        <strong class="text-yellow-600 text-sm">PUT /api/events/:id</strong>
                        <p class="text-gray-600 mt-1 text-xs">Update an event</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border-l-4 border-red-500">
                        <strong class="text-red-600 text-sm">DELETE /api/events/:id</strong>
                        <p class="text-gray-600 mt-1 text-xs">Delete an event</p>
                    </div>
                    <div class="bg-gray-50 p-3 rounded-lg border-l-4 border-purple-500">
                        <strong class="text-purple-600 text-sm">GET /api/health</strong>
                        <p class="text-gray-600 mt-1 text-xs">Server health check</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Event Creation Modal -->
    <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl">
                <!-- Modal Header -->
                <div class="p-6 bg-gradient-to-r from-green-500 to-green-600 rounded-t-2xl">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-semibold text-white">➕ Create New Event</h2>
                        <button onclick="closeEventModal()" class="text-white hover:text-gray-200 transition-colors duration-200">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Modal Body -->
                <div class="p-6">
                    <form id="eventForm" class="space-y-4">
                        <div>
                            <label for="summary" class="block text-sm font-medium text-gray-700 mb-2">
                                Event Title *
                            </label>
                            <input 
                                type="text" 
                                id="summary" 
                                name="summary" 
                                required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                placeholder="Enter event title">
                        </div>

                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
                                Description
                            </label>
                            <textarea 
                                id="description" 
                                name="description" 
                                rows="2"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                placeholder="Enter event description"></textarea>
                        </div>

                        <div>
                            <label for="location" class="block text-sm font-medium text-gray-700 mb-2">
                                Location
                            </label>
                            <input 
                                type="text" 
                                id="location" 
                                name="location"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                placeholder="Enter event location">
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="start" class="block text-sm font-medium text-gray-700 mb-2">
                                    Start Time *
                                </label>
                                <input 
                                    type="datetime-local" 
                                    id="start" 
                                    name="start" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                            </div>
                            <div>
                                <label for="end" class="block text-sm font-medium text-gray-700 mb-2">
                                    End Time *
                                </label>
                                <input 
                                    type="datetime-local" 
                                    id="end" 
                                    name="end" 
                                    required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Reminders
                            </label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="emailReminder" class="mr-2 text-green-500 focus:ring-green-500">
                                    <span class="text-sm text-gray-700">Email (30 min before)</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="popupReminder" class="mr-2 text-green-500 focus:ring-green-500">
                                    <span class="text-sm text-gray-700">Popup (10 min before)</span>
                                </label>
                            </div>
                        </div>

                        <!-- Quick Event Templates -->
                        <div class="pt-3 border-t border-gray-200">
                            <h3 class="text-sm font-semibold text-gray-800 mb-2">⚡ Quick Templates</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                                <button type="button" onclick="fillQuickEvent('meeting')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs text-gray-700 transition-colors duration-200 text-left">
                                    💼 Team Meeting
                                </button>
                                <button type="button" onclick="fillQuickEvent('lunch')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs text-gray-700 transition-colors duration-200 text-left">
                                    🍽️ Lunch Break
                                </button>
                                <button type="button" onclick="fillQuickEvent('call')" class="px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-xs text-gray-700 transition-colors duration-200 text-left">
                                    📞 Client Call
                                </button>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="flex gap-3 pt-3">
                            <button 
                                type="submit" 
                                class="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-all duration-200 hover:scale-105 shadow-lg">
                                🚀 Create Event
                            </button>
                            <button 
                                type="button" 
                                onclick="closeEventModal()"
                                class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white font-medium rounded-lg transition-all duration-200">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Modal functions
        function openEventModal() {
            document.getElementById('eventModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            setDefaultDatetime();
        }

        function closeEventModal() {
            document.getElementById('eventModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // Close modal when clicking outside
        document.getElementById('eventModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEventModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !document.getElementById('eventModal').classList.contains('hidden')) {
                closeEventModal();
            }
        });

        // Set default datetime values (tomorrow at 9 AM)
        function setDefaultDatetime() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(9, 0, 0, 0);
            
            const endTime = new Date(tomorrow);
            endTime.setHours(10, 0, 0, 0);
            
            document.getElementById('start').value = tomorrow.toISOString().slice(0, 16);
            document.getElementById('end').value = endTime.toISOString().slice(0, 16);
        }

        // Quick event templates
        function fillQuickEvent(type) {
            const now = new Date();
            let startTime, endTime, summary, description;
            
            switch(type) {
                case 'meeting':
                    startTime = new Date(now.getTime() + 24 * 60 * 60 * 1000); // Tomorrow
                    startTime.setHours(10, 0, 0, 0);
                    endTime = new Date(startTime.getTime() + 60 * 60 * 1000); // +1 hour
                    summary = 'Team Meeting';
                    description = 'Weekly team sync meeting';
                    break;
                case 'lunch':
                    startTime = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                    startTime.setHours(12, 0, 0, 0);
                    endTime = new Date(startTime.getTime() + 60 * 60 * 1000);
                    summary = 'Lunch Break';
                    description = 'Lunch break';
                    break;
                case 'call':
                    startTime = new Date(now.getTime() + 24 * 60 * 60 * 1000);
                    startTime.setHours(14, 0, 0, 0);
                    endTime = new Date(startTime.getTime() + 30 * 60 * 1000); // +30 min
                    summary = 'Client Call';
                    description = 'Client consultation call';
                    break;
            }
            
            document.getElementById('summary').value = summary;
            document.getElementById('description').value = description;
            document.getElementById('start').value = startTime.toISOString().slice(0, 16);
            document.getElementById('end').value = endTime.toISOString().slice(0, 16);
        }

        // Form submission
        document.getElementById('eventForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const eventData = {
                summary: formData.get('summary'),
                description: formData.get('description'),
                location: formData.get('location'),
                start: formData.get('start'),
                end: formData.get('end')
            };

            try {
                showStatus('Creating event...', 'info');
                
                const response = await fetch('/api/events', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(eventData)
                });

                if (response.ok) {
                    const result = await response.json();
                    showStatus('✅ Event created successfully!', 'success');
                    e.target.reset();
                    closeEventModal();
                    
                    // Refresh calendar after a short delay
                    setTimeout(() => {
                        refreshCalendar();
                    }, 1000);
                } else {
                    const error = await response.json();
                    showStatus(`❌ Failed to create event: ${error.error}`, 'error');
                }
            } catch (error) {
                showStatus(`❌ Error: ${error.message}`, 'error');
            }
        });

        function refreshCalendar() {
            const iframe = document.querySelector('iframe');
            iframe.src = iframe.src;
            showStatus('🔄 Calendar refreshed successfully!', 'success');
        }

        function showAPIInfo() {
            const apiSection = document.getElementById('apiSection');
            apiSection.style.display = apiSection.style.display === 'none' ? 'block' : 'none';
        }

        async function testAPI() {
            try {
                showStatus('🧪 Testing API connection...', 'info');
                
                const response = await fetch('/api/events');
                if (response.ok) {
                    const data = await response.json();
                    showStatus(`✅ API working! Found ${data.length} events`, 'success');
                } else {
                    showStatus('❌ API test failed', 'error');
                }
            } catch (error) {
                showStatus('❌ API test failed: ' + error.message, 'error');
            }
        }

        function showStatus(message, type) {
            const status = document.getElementById('status');
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'info' ? 'bg-blue-500' : 'bg-gray-500';
            
            status.innerHTML = `
                <div class="${bgColor} text-white px-6 py-4 rounded-lg shadow-lg">
                    <p class="font-medium">${message}</p>
                </div>
            `;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }

        // Auto-refresh calendar every 5 minutes
        setInterval(refreshCalendar, 5 * 60 * 1000);
    </script>
</body>
</html>